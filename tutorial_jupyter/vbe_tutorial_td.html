<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Frequently Asked Questions" href="../faq.html" /><link rel="prev" title="Variational Basis State Encoder (Ground State)" href="vbe_tutorial_groundstate.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2023.09.10 -->
        <title>Variational Basis State Encoder (Time Dependent) - TenCirChem documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">TenCirChem  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logov0.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">Advanced Topics</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ucc_functions.html">UCC Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="h2o_pes.html">Potential Energy Surface of the Water Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="adapt_vqe.html">ADAPT VQE</a></li>
<li class="toctree-l2"><a class="reference internal" href="engine_benchmark.html">Benchmark engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="hubbard_model.html">Hubbard Model by UCCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="noisy_simulation.html">Noisy Circuit Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sbm_dynamics.html">Dynamics of the Spin-Boson Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="marcus.html">Observing Marcus Inverted Region</a></li>
<li class="toctree-l2"><a class="reference internal" href="vbe_tutorial_groundstate.html">Variational Basis State Encoder (Ground State)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Variational Basis State Encoder (Time Dependent)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/uccsd.html">UCCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/kupccgsd.html">k-UpCCGSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/puccd.html">Paired UCCD (pUCCD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ucc.html">UCC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/hea.html">Headware-Efficient Ansatz and Noisy Circuit Simulation</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Variational-Basis-State-Encoder-(Time-Dependent)">
<h1>Variational Basis State Encoder (Time Dependent)<a class="headerlink" href="#Variational-Basis-State-Encoder-(Time-Dependent)" title="Permalink to this heading">#</a></h1>
<section id="1-Background">
<h2>1 Background<a class="headerlink" href="#1-Background" title="Permalink to this heading">#</a></h2>
<p>This tutorial is for the time evolution of variational basis state encoder (VBE). Here, spin-boson model is taken as an example. As shall be presented below, the key is to calculate <span class="math notranslate nohighlight">\(\dot{\theta}_j\)</span> and <span class="math notranslate nohighlight">\(\dot{C}[l]^*\)</span>. The algorithm realization are presented in section 2. For more theoretical derivations, see <a class="reference external" href="https://doi.org/10.1103/PhysRevResearch.5.023046">https://doi.org/10.1103/PhysRevResearch.5.023046</a>.</p>
</section>
<section id="2-Algorithm-Realization">
<h2>2 Algorithm Realization<a class="headerlink" href="#2-Algorithm-Realization" title="Permalink to this heading">#</a></h2>
<section id="2.1-Imports">
<h3>2.1 Imports<a class="headerlink" href="#2.1-Imports" title="Permalink to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">from</span> <span class="nn">opt_einsum</span> <span class="kn">import</span> <span class="n">contract</span>
<span class="kn">import</span> <span class="nn">tensorcircuit</span> <span class="k">as</span> <span class="nn">tc</span>

<span class="kn">from</span> <span class="nn">tencirchem</span> <span class="kn">import</span> <span class="n">set_backend</span><span class="p">,</span> <span class="n">Op</span><span class="p">,</span> <span class="n">Mpo</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">OpSum</span>
<span class="kn">from</span> <span class="nn">tencirchem.dynamic</span> <span class="kn">import</span> <span class="n">get_ansatz</span><span class="p">,</span> <span class="n">get_deriv</span><span class="p">,</span> <span class="n">get_jacobian_func</span><span class="p">,</span> <span class="n">qubit_encode_basis</span><span class="p">,</span> <span class="n">sbm</span>
<span class="kn">from</span> <span class="nn">tencirchem.applications.vbe_lib</span> <span class="kn">import</span> <span class="n">get_psi_indices</span><span class="p">,</span> <span class="n">get_contracted_mpo</span><span class="p">,</span> <span class="n">get_contract_args</span>
</pre></div>
</div>
</div>
</section>
<section id="2.2-Initialize">
<h3>2.2 Initialize<a class="headerlink" href="#2.2-Initialize" title="Permalink to this heading">#</a></h3>
<p>In this tutorial, we study the time evolution of the following spin-boson model:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{H}=\frac{\epsilon}{2} \hat{\sigma}_z + \Delta\hat{\sigma}_x + \sum_j g_j \omega_j \hat{\sigma}_z (\hat{b}^\dagger_j + \hat{b}_j)
+ \sum_j \omega_j \hat{b}^\dagger_j \hat{b}_j\]</div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">epsilon</span></code>, <code class="docutils literal notranslate"><span class="pre">delta</span></code>, <code class="docutils literal notranslate"><span class="pre">omega_list</span></code> and <code class="docutils literal notranslate"><span class="pre">g_list</span></code> correspond to <span class="math notranslate nohighlight">\(\epsilon\)</span>, <span class="math notranslate nohighlight">\(\Delta\)</span>, <span class="math notranslate nohighlight">\(\omega_j\)</span> and <span class="math notranslate nohighlight">\(g_j\)</span> in the Hamiltonian, respectively. In this section, the parameters are defined and the circuit is initialized. The schematic diagram of the circuit is plotted in Fig. 1, where blue square corresponds to qubit representing spin and green circles correspond to qubits representing vibrations. <img alt="fig1" src="../_images/vbe_td_Fig1.svg" /> Fig. 1 Schematic diagram of the circuit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;jax&quot;</span><span class="p">)</span>

<span class="n">epsilon</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">omega_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">g_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">nmode</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omega_list</span><span class="p">)</span>  <span class="c1"># number of phonon modes</span>
<span class="c1"># make sure correct input</span>
<span class="k">assert</span> <span class="n">nmode</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_list</span><span class="p">)</span>

<span class="c1"># two qubit for each mode</span>
<span class="n">n_qubit_per_mode</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nbas_v</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n_qubit_per_mode</span>

<span class="c1"># -1 for electron dof, natural numbers for phonon dof</span>
<span class="n">dof_nature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_qubit_per_mode</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_qubit_per_mode</span><span class="p">)</span>
<span class="n">b_dof_pidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>  <span class="c1"># index of basis that need VBE</span>

<span class="n">n_dof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dof_nature</span><span class="p">)</span>
<span class="n">psi_shape2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_dof</span>

<span class="n">psi_idx_top</span><span class="p">,</span> <span class="n">psi_idx_bottom</span><span class="p">,</span> <span class="n">b_dof_vidx</span> <span class="o">=</span> <span class="n">get_psi_indices</span><span class="p">(</span><span class="n">dof_nature</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;psi_index_top: &quot;</span><span class="p">,</span>
    <span class="n">psi_idx_bottom</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">psi_index_bottom: &quot;</span><span class="p">,</span>
    <span class="n">psi_idx_bottom</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">b_dof_vidx: &quot;</span><span class="p">,</span>
    <span class="n">b_dof_vidx</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">psi_shape2: &quot;</span><span class="p">,</span>
    <span class="n">psi_shape2</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># spin boson model has been define in tencirchem.dynamic.model</span>
<span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">nmode</span><span class="p">,</span> <span class="n">omega_list</span><span class="p">,</span> <span class="n">g_list</span><span class="p">,</span> <span class="n">nlevels</span><span class="p">):</span>
    <span class="n">ham_terms</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">get_ham_terms</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">nmode</span><span class="p">,</span> <span class="n">omega_list</span><span class="p">,</span> <span class="n">g_list</span><span class="p">)</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">get_basis</span><span class="p">(</span><span class="n">omega_list</span><span class="p">,</span> <span class="n">nlevels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">ham_terms</span><span class="p">)</span>


<span class="n">nbas</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># number of phonon levels (basis)</span>

<span class="n">b_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_qubit_per_mode</span> <span class="o">+</span> <span class="p">[</span><span class="n">nbas</span><span class="p">])</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">omega_list</span><span class="p">)</span> <span class="o">==</span> <span class="n">nmode</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">g_list</span><span class="p">)</span> <span class="o">==</span> <span class="n">nmode</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">nmode</span><span class="p">,</span> <span class="n">omega_list</span><span class="p">,</span> <span class="n">g_list</span><span class="p">,</span> <span class="p">[</span><span class="n">nbas</span><span class="p">]</span> <span class="o">*</span> <span class="n">nmode</span><span class="p">)</span>

<span class="n">h_mpo</span> <span class="o">=</span> <span class="n">Mpo</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># generate the quantum circuit with defined qubits</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">Circuit</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nmode</span> <span class="o">*</span> <span class="n">n_qubit_per_mode</span><span class="p">)</span>
<span class="n">psi0</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
<span class="n">n_layers</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># layers of ansatz</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-08-08 16:12:43.927000: E external/org_tensorflow/tensorflow/compiler/xla/stream_executor/cuda/cuda_driver.cc:267] failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected
WARNING:jax._src.lib.xla_bridge:No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
psi_index_top:  [&#39;p-0-bottom&#39;, &#39;v-1-0-bottom&#39;, &#39;v-1-1-bottom&#39;, &#39;v-2-0-bottom&#39;, &#39;v-2-1-bottom&#39;]
psi_index_bottom:  [&#39;p-0-bottom&#39;, &#39;v-1-0-bottom&#39;, &#39;v-1-1-bottom&#39;, &#39;v-2-0-bottom&#39;, &#39;v-2-1-bottom&#39;]
b_dof_vidx:  [array([1, 2]), array([3, 4])]
psi_shape2:  [2, 2, 2, 2, 2]
</pre></div></div>
</div>
</section>
<section id="2.3-Get-variational-Hamiltonian-ansatz-terms">
<h3>2.3 Get variational Hamiltonian ansatz terms<a class="headerlink" href="#2.3-Get-variational-Hamiltonian-ansatz-terms" title="Permalink to this heading">#</a></h3>
<p>In this section, we will generate variational hamiltonian ansatz terms. The following ansatz is adopted:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\ket{\phi} = \prod_n e^{i \theta_n \hat {h}_{a_n}} \ket{\phi_0}\]</div>
</div>
<p>if</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{H}=\sum_a J_a \hat{h}_a\]</div>
</div>
<p>Note that the phonon operators have been transformed to qubit operators based on Gray Encoding.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_vha_terms</span><span class="p">():</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">get_basis</span><span class="p">(</span><span class="n">omega_list</span><span class="p">,</span> <span class="p">[</span><span class="n">nbas_v</span><span class="p">]</span> <span class="o">*</span> <span class="n">nmode</span><span class="p">)</span>
    <span class="n">spin_basis</span> <span class="o">=</span> <span class="n">qubit_encode_basis</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>

    <span class="n">spin_ham_terms</span> <span class="o">=</span> <span class="n">OpSum</span><span class="p">([</span><span class="n">Op</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;spin&quot;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmode</span><span class="p">):</span>
        <span class="n">complete_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit_per_mode</span><span class="p">):</span>
            <span class="n">complete</span> <span class="o">=</span> <span class="n">OpSum</span><span class="p">()</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TCCQUBIT-</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="s2">&quot;IXYZ&quot;</span><span class="p">:</span>
                <span class="n">complete</span> <span class="o">+=</span> <span class="n">Op</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>
            <span class="n">complete_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span>
        <span class="n">complete_real</span> <span class="o">=</span> <span class="n">complete_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">complete_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">complete_real</span> <span class="o">=</span> <span class="n">complete_real</span> <span class="o">*</span> <span class="n">c</span>
        <span class="n">spin_ham_terms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">complete_real</span><span class="p">)</span>
        <span class="n">spin_ham_terms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">complete_real</span><span class="p">)</span>
    <span class="n">spin_ham_terms</span> <span class="o">=</span> <span class="n">OpSum</span><span class="p">([</span><span class="n">op</span><span class="o">.</span><span class="n">squeeze_identity</span><span class="p">()</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">spin_ham_terms</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">is_identity</span><span class="p">])</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">spin_ham_terms</span><span class="p">,</span> <span class="n">spin_basis</span>


<span class="n">spin_ham_terms</span><span class="p">,</span> <span class="n">spin_basis</span> <span class="o">=</span> <span class="n">get_vha_terms</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">spin_basis</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spin_ham_terms</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">spin_ham_terms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


<span class="n">theta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_layers</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spin_ham_terms</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">ansatz</span> <span class="o">=</span> <span class="n">get_ansatz</span><span class="p">(</span><span class="n">spin_ham_terms</span><span class="p">,</span> <span class="n">spin_basis</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">psi0</span><span class="p">)</span>
<span class="n">jacobian_func</span> <span class="o">=</span> <span class="n">get_jacobian_func</span><span class="p">(</span><span class="n">ansatz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[BasisHalfSpin(dof: spin, nbas: 2), BasisHalfSpin(dof: (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), nbas: 2), BasisHalfSpin(dof: (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;), nbas: 2), BasisHalfSpin(dof: (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), nbas: 2), BasisHalfSpin(dof: (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;), nbas: 2)]
Op(&#39;X&#39;, [&#39;spin&#39;], 1.0)
Op(&#39;X&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;X X&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X Y&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X Z&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Y X&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y Y&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y Z&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z X&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z&#39;, [(&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z&#39;, [&#39;spin&#39;], 2.0)
Op(&#39;Z X&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z X X&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X Y&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X Z&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z Y X&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y Y&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y Z&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z Z X&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z Y&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z Z&#39;, [&#39;spin&#39;, (&#39;v0&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v0&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;X X&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X Y&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;X Z&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Y X&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y Y&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Y Z&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z X&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z&#39;, [(&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z X X&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X Y&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z X Z&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z Y X&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y Y&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Y Z&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;)], 1.0)
Op(&#39;Z Z X&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z Y&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
Op(&#39;Z Z Z&#39;, [&#39;spin&#39;, (&#39;v1&#39;, &#39;TCCQUBIT-0&#39;), (&#39;v1&#39;, &#39;TCCQUBIT-1&#39;)], 1.0)
</pre></div></div>
</div>
</section>
<section id="2.4-Time-Evolution">
<h3>2.4 Time Evolution<a class="headerlink" href="#2.4-Time-Evolution" title="Permalink to this heading">#</a></h3>
<p>This sections defines the function involved in time evolution. The derivations <span class="math notranslate nohighlight">\(\dot{\theta}_j\)</span> are calculated by following equation:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\sum_j \textrm{Re} \frac{\partial \bra{\phi}}{\partial \theta_k} \frac{\partial \ket{\phi}}{\partial \theta_j}\dot{\theta}_j =
\textrm{Im} \frac{\partial \bra{\phi}}{\partial \theta_k} \hat {H}_1\]</div>
</div>
<p>where</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{H}_1=\prod_{l}\hat{B}[l] \hat{H} \prod_{l}\hat{B}[l]^\dagger\]</div>
</div>
<p>, and <span class="math notranslate nohighlight">\(\frac{\partial \ket{\phi}}{\partial \theta_j}\)</span> is calculated via <code class="docutils literal notranslate"><span class="pre">theta_deriv</span></code>. The time derivations of <span class="math notranslate nohighlight">\(B[l]\)</span> are calculated by following equations:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[i\rho[l]\dot{B}[l]^* = (1-\hat{P}[l])\bra{\phi}\tilde{H}'[l]\ket{\phi}\]</div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\dot{B}[l]^* = -i \rho[l]^{-1}(1-\hat{P}[l])\bra{\phi}\tilde{H}'[l]\ket{\phi}\]</div>
</div>
<p>where</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\tilde{H}'=\left( \prod_{k\neq l}\hat{B}[l] \hat{H} \prod_{k\neq l}\hat{B}[k]^\dagger \right) \hat{B}[l]^\dagger\]</div>
</div>
<p>the projection operator</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{P}[l]=\hat{B}[l]^\dagger\hat{B}[l]\]</div>
</div>
<p>and the reduced density matrix</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\rho[l]_{nn'}=\textrm{Tr} \left[ \bra{\phi}\ket{n}_l \bra{n'}_l \ket{\phi} \right ]\]</div>
</div>
<p>An example that illustrates the function in detail is also presented below. <img alt="fig2" src="../_images/vbe_td_Fig2.svg" /> Fig. 2 Graphic illustration of (a) <span class="math notranslate nohighlight">\(\rho[l]\)</span>, (b) <span class="math notranslate nohighlight">\(P[l]\)</span>, (c) <span class="math notranslate nohighlight">\(\bra\phi\tilde{H}'[l]\ket\phi\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">deriv_fun</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">theta_and_b</span><span class="p">):</span>
    <span class="c1"># split \thera and b to independent arrays</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_and_b</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta0</span><span class="p">)]</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">b_array</span> <span class="o">=</span> <span class="n">theta_and_b</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">theta0</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nmode</span><span class="p">,</span> <span class="n">nbas_v</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>

    <span class="c1"># get contracted H</span>
    <span class="n">h_contracted</span> <span class="o">=</span> <span class="n">get_contracted_mpo</span><span class="p">(</span><span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">,</span> <span class="n">psi_idx_top</span> <span class="o">+</span> <span class="n">psi_idx_bottom</span><span class="p">)</span>
    <span class="c1"># get the derivation of \theta</span>
    <span class="n">theta_deriv</span> <span class="o">=</span> <span class="n">get_deriv</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">jacobian_func</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">h_contracted</span><span class="p">)</span>

    <span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psi_shape2</span><span class="p">)</span>
    <span class="n">b_deriv_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmode</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># calculate rho</span>
        <span class="n">indices_base</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;contract&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dof</span><span class="p">)]</span>
        <span class="n">psi_top_indices</span> <span class="o">=</span> <span class="n">indices_base</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">psi_bottom_indices</span> <span class="o">=</span> <span class="n">indices_base</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b_dof_vidx</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">psi_top_indices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">psi_bottom_indices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="n">out_indices</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b_dof_vidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b_dof_vidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">psi</span><span class="o">.</span><span class="n">conj</span><span class="p">(),</span> <span class="n">psi_top_indices</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_bottom_indices</span><span class="p">,</span> <span class="n">out_indices</span><span class="p">]</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n_qubit_per_mode</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">pinv</span>

        <span class="n">rho</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-5</span>
        <span class="n">rho_inv</span> <span class="o">=</span> <span class="n">pinv</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nbas_v</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>
        <span class="c1"># calculate projector</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span>

        <span class="c1"># derivative</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">get_contract_args</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">psi_idx_top</span><span class="p">,</span> <span class="n">psi_idx_bottom</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">b_dof_pidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b_shape</span><span class="p">))</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">-bottom&quot;</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit_per_mode</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-bottom&quot;</span><span class="p">])</span>
        <span class="c1"># output indices</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">-top&quot;</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit_per_mode</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-top&quot;</span><span class="p">,</span> <span class="s2">&quot;mpo-0&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mpo-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">h_mpo</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

        <span class="c1"># take transpose to be compatible with previous code</span>
        <span class="n">b_deriv</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nbas_v</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">b_deriv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bf, bg -&gt; fg&quot;</span><span class="p">,</span> <span class="n">b_deriv</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nbas</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">)</span>
        <span class="n">b_deriv</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;fg, fh -&gt; hg&quot;</span><span class="p">,</span> <span class="n">b_deriv</span><span class="p">,</span> <span class="n">rho_inv</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">b_deriv_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_deriv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">theta_deriv</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_deriv_list</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<p>Lets illustrate the code in detail. Code that calculates <span class="math notranslate nohighlight">\(\rho[l]\)</span> (see Fig. 2(a))</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># split \thera and b to independent arrays</span>

<span class="n">b_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmode</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nbas</span><span class="p">)[:</span><span class="n">nbas_v</span><span class="p">]</span>  <span class="c1"># nbas_v * nbas</span>
    <span class="n">b_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">theta_and_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">theta0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_list</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">theta_and_b</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta0</span><span class="p">)]</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="n">b_array</span> <span class="o">=</span> <span class="n">theta_and_b</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">theta0</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nmode</span><span class="p">,</span> <span class="n">nbas_v</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>

<span class="c1"># get contracted H</span>
<span class="n">h_contracted</span> <span class="o">=</span> <span class="n">get_contracted_mpo</span><span class="p">(</span><span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">,</span> <span class="n">psi_idx_top</span> <span class="o">+</span> <span class="n">psi_idx_bottom</span><span class="p">)</span>
<span class="c1"># get the derivation of \theta</span>
<span class="n">theta_deriv</span> <span class="o">=</span> <span class="n">get_deriv</span><span class="p">(</span><span class="n">ansatz</span><span class="p">,</span> <span class="n">jacobian_func</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">h_contracted</span><span class="p">)</span>

<span class="n">psi</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">psi_shape2</span><span class="p">)</span>
<span class="n">b_deriv_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mode &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># calculate rho[l]</span>
<span class="n">indices_base</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;contract&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dof</span><span class="p">)]</span>
<span class="n">psi_top_indices</span> <span class="o">=</span> <span class="n">indices_base</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">psi_bottom_indices</span> <span class="o">=</span> <span class="n">indices_base</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b_dof_vidx</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
    <span class="n">psi_top_indices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="n">psi_bottom_indices</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
<span class="n">out_indices</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b_dof_vidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b_dof_vidx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out_indices: &quot;</span><span class="p">,</span> <span class="n">out_indices</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">psi</span><span class="o">.</span><span class="n">conj</span><span class="p">(),</span> <span class="n">psi_top_indices</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">psi_bottom_indices</span><span class="p">,</span> <span class="n">out_indices</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;args: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n_qubit_per_mode</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rho: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">pinv</span>

<span class="n">rho</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e-5</span>
<span class="n">rho_inv</span> <span class="o">=</span> <span class="n">pinv</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mode  0
out_indices:  [(&#39;top&#39;, 1), (&#39;top&#39;, 2), (&#39;bottom&#39;, 1), (&#39;bottom&#39;, 2)]
args:
 [DeviceArray([[[[[1.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]],


              [[[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]]],



             [[[[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]],


              [[[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]]]], dtype=complex128), [(&#39;contract&#39;, 0), (&#39;top&#39;, 1), (&#39;top&#39;, 2), (&#39;contract&#39;, 3), (&#39;contract&#39;, 4)], DeviceArray([[[[[1.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]],


              [[[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]]],



             [[[[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]],


              [[[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]]]], dtype=complex128), [(&#39;contract&#39;, 0), (&#39;bottom&#39;, 1), (&#39;bottom&#39;, 2), (&#39;contract&#39;, 3), (&#39;contract&#39;, 4)], [(&#39;top&#39;, 1), (&#39;top&#39;, 2), (&#39;bottom&#39;, 1), (&#39;bottom&#39;, 2)]]
rho:
 [[1.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j]]
</pre></div></div>
</div>
<p>Code that calculates <span class="math notranslate nohighlight">\(\hat{P}[l]\)</span>, (see Fig. 2(b))</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nbas_v</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>
<span class="c1"># calculate projector P[l]</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">b</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;proj: &quot;</span><span class="p">,</span> <span class="n">proj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
proj:  [[1.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 1.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 1.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 1.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]
 [0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j
  0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j 0.+0.j]]
</pre></div></div>
</div>
<p>Code that calculates <span class="math notranslate nohighlight">\(\bra{\phi}\tilde{H}'[l]\ket{\phi}\)</span> (see Fig. 2(c))</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># derivative</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">get_contract_args</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">psi_idx_top</span><span class="p">,</span> <span class="n">psi_idx_bottom</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">b_dof_pidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b_shape</span><span class="p">))</span>
<span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">-bottom&quot;</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit_per_mode</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-bottom&quot;</span><span class="p">])</span>
<span class="c1"># output indices</span>
<span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">-top&quot;</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_qubit_per_mode</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;p-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-top&quot;</span><span class="p">,</span> <span class="s2">&quot;mpo-0&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mpo-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">h_mpo</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;args in derivative: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

<span class="c1"># take transpose to be compatible with previous code</span>
<span class="n">b_deriv</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nbas_v</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
args in derivative:
 [DeviceArray([[[[[1.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]],


              [[[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]]],



             [[[[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]],


              [[[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]],

               [[0.-0.j, 0.-0.j],
                [0.-0.j, 0.-0.j]]]]], dtype=complex128), [&#39;p-0-top&#39;, &#39;v-1-0-top&#39;, &#39;v-1-1-top&#39;, &#39;v-2-0-top&#39;, &#39;v-2-1-top&#39;], DeviceArray([[[[[1.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]],


              [[[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]]],



             [[[[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]],


              [[[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]],

               [[0.+0.j, 0.+0.j],
                [0.+0.j, 0.+0.j]]]]], dtype=complex128), [&#39;p-0-bottom&#39;, &#39;v-1-0-bottom&#39;, &#39;v-1-1-bottom&#39;, &#39;v-2-0-bottom&#39;, &#39;v-2-1-bottom&#39;], &lt;Matrix at 0x7f68b5462690 (1, 2, 2, 3) float64&gt;, [&#39;mpo-0&#39;, &#39;p-0-top&#39;, &#39;p-0-bottom&#39;, &#39;mpo-1&#39;], &lt;Matrix at 0x7f68503148d0 (3, 16, 16, 3) float64&gt;, [&#39;mpo-1&#39;, &#39;p-1-top&#39;, &#39;p-1-bottom&#39;, &#39;mpo-2&#39;], &lt;Matrix at 0x7f68503147d0 (3, 16, 16, 1) float64&gt;, [&#39;mpo-2&#39;, &#39;p-2-top&#39;, &#39;p-2-bottom&#39;, &#39;mpo-3&#39;], array([[[1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
        [0.+0.j, 1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j]],

       [[0.+0.j, 0.+0.j, 1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
        [0.+0.j, 0.+0.j, 0.+0.j, 1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j]]]), [&#39;v-2-0-bottom&#39;, &#39;v-2-1-bottom&#39;, &#39;p-2-bottom&#39;], array([[[1.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j,
         0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j],
        [0.-0.j, 1.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j,
         0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j]],

       [[0.-0.j, 0.-0.j, 1.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j,
         0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j],
        [0.-0.j, 0.-0.j, 0.-0.j, 1.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j,
         0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j, 0.-0.j]]]), [&#39;v-2-0-top&#39;, &#39;v-2-1-top&#39;, &#39;p-2-top&#39;], array([[[1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
        [0.+0.j, 1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j]],

       [[0.+0.j, 0.+0.j, 1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j],
        [0.+0.j, 0.+0.j, 0.+0.j, 1.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j,
         0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j, 0.+0.j]]]), [&#39;v-1-0-bottom&#39;, &#39;v-1-1-bottom&#39;, &#39;p-1-bottom&#39;], [&#39;v-1-0-top&#39;, &#39;v-1-1-top&#39;, &#39;p-1-top&#39;, &#39;mpo-0&#39;, &#39;mpo-3&#39;]]
</pre></div></div>
</div>
<p>Contract tensors and calculate <span class="math notranslate nohighlight">\(\dot{B}[l]^*\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b_deriv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;bf, bg -&gt; fg&quot;</span><span class="p">,</span> <span class="n">b_deriv</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nbas</span><span class="p">)</span> <span class="o">-</span> <span class="n">proj</span><span class="p">)</span>
<span class="n">b_deriv</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;fg, fh -&gt; hg&quot;</span><span class="p">,</span> <span class="n">b_deriv</span><span class="p">,</span> <span class="n">rho_inv</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">b_deriv_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_deriv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="2.5-Main-Structure-of-the-Function">
<h2>2.5 Main Structure of the Function<a class="headerlink" href="#2.5-Main-Structure-of-the-Function" title="Permalink to this heading">#</a></h2>
<p>This is the main stucture of the code. We set parameters for time evolution and initialize the system. Then, we update <code class="docutils literal notranslate"><span class="pre">theta_and_b</span></code> in time evolution and calcutate <span class="math notranslate nohighlight">\(\langle \sigma_z \rangle\)</span> <code class="docutils literal notranslate"><span class="pre">z</span></code> and <span class="math notranslate nohighlight">\(\langle \sigma_x \rangle\)</span> <code class="docutils literal notranslate"><span class="pre">x</span></code> step by step as the time evolves.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_layers</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">spin_ham_terms</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">ansatz</span> <span class="o">=</span> <span class="n">get_ansatz</span><span class="p">(</span><span class="n">spin_ham_terms</span><span class="p">,</span> <span class="n">spin_basis</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">psi0</span><span class="p">)</span>
<span class="n">jacobian_func</span> <span class="o">=</span> <span class="n">get_jacobian_func</span><span class="p">(</span><span class="n">ansatz</span><span class="p">)</span>

<span class="n">b_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmode</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nbas</span><span class="p">)[:</span><span class="n">nbas_v</span><span class="p">]</span>  <span class="c1"># nbas_v * nbas</span>
    <span class="n">b_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">theta_and_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">theta0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_list</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">z_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">tau</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">steps</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">dummy_model</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">nmode</span><span class="p">,</span> <span class="n">omega_list</span><span class="p">,</span> <span class="n">g_list</span><span class="p">,</span> <span class="p">[</span><span class="n">nbas_v</span><span class="p">]</span> <span class="o">*</span> <span class="n">nmode</span><span class="p">)</span>
<span class="n">z_op</span> <span class="o">=</span> <span class="n">Mpo</span><span class="p">(</span><span class="n">dummy_model</span><span class="p">,</span> <span class="n">Op</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
<span class="n">x_op</span> <span class="o">=</span> <span class="n">Mpo</span><span class="p">(</span><span class="n">dummy_model</span><span class="p">,</span> <span class="n">Op</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">z_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># update `theta_and_b`</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">deriv_fun</span><span class="p">,</span> <span class="p">[</span><span class="n">n</span> <span class="o">*</span> <span class="n">tau</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tau</span><span class="p">],</span> <span class="n">theta_and_b</span><span class="p">)</span>
    <span class="n">theta_and_b</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta_and_b</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta0</span><span class="p">)]</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">z_op</span> <span class="o">@</span> <span class="n">psi</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">x_op</span> <span class="o">@</span> <span class="n">psi</span><span class="p">)</span>
    <span class="n">z_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 1.0
1 0.9801368820199942
2 0.9221622297057478
3 0.8307164281767181
4 0.712902625694087
5 0.5774908043700016
6 0.4340489975856556
7 0.29215043357543824
8 0.1607516949764221
9 0.04771089791814444
10 -0.040502642430565255
11 -0.09904787191380995
12 -0.12493534752914795
13 -0.11727456640490394
14 -0.07753204265425653
15 -0.009732009482324864
16 0.0795128404043315
17 0.18126828150880098
18 0.2849420221890886
19 0.37936481084384754
20 0.454192768911805
21 0.5014051186981502
22 0.5165776398039041
23 0.49960262655096854
24 0.454624729908236
25 0.38915769753158064
26 0.31259780970942813
27 0.2345813095925135
28 0.1636633691524335
29 0.10653226239863313
30 0.06766729976756988
31 0.04926876472593326
32 0.05139921686178229
33 0.07232882932406118
34 0.10899831508240451
35 0.15745403958628454
36 0.21315107699434557
37 0.27112011043252915
38 0.3261026901074539
39 0.3728086768061548
40 0.40637666288671287
41 0.4229683862535386
42 0.42032486089352117
43 0.3981218276511652
44 0.358045462603464
45 0.303614837159146
46 0.23991582373561202
47 0.17311347674692437
48 0.10948894653071074
49 0.05440718215103625
50 0.011717807210271824
51 -0.016427087542680092
52 -0.02981545362112685
53 -0.030162355384666367
54 -0.020379375716308275
55 -0.0033909784547891857
56 0.018576266600602798
57 0.04368717824936481
58 0.06971819393413235
59 0.09364096597083588
60 0.11186039266314592
61 0.12076156704155695
62 0.11755115511155295
63 0.10090752714979544
64 0.07138982669111976
65 0.03253624871953725
66 -0.011552300380283664
67 -0.05607764510179323
68 -0.09628855507563477
69 -0.12836308326138923
70 -0.14994039236833612
71 -0.1596458713814789
72 -0.15576794369843444
73 -0.1373071561893098
74 -0.10671249014129201
75 -0.06743879382842288
76 -0.022285878126101024
77 0.024280809221682687
78 0.06810377510953083
79 0.10678673871439198
80 0.13914885388461803
81 0.1611886576331503
82 0.16581373326788112
83 0.1542497273174869
84 0.13048909287272364
85 0.09708896314020657
86 0.057310903820287765
87 0.015533678436258006
88 -0.024192504501293052
89 -0.05790366853755518
90 -0.0797592370408079
91 -0.08582739907891124
92 -0.07396770719727741
93 -0.048080239560664026
94 -0.012411290850183795
95 0.031070370091046573
96 0.08042891268644264
97 0.13037553828085885
98 0.17451072357728148
99 0.20513840470656897
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the outcome</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">mpl_config</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">101</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_list</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;t (a.u.)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\langle \sigma_z \rangle$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_jupyter_vbe_tutorial_td_21_0.png" src="../_images/tutorial_jupyter_vbe_tutorial_td_21_0.png" />
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../faq.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Frequently Asked Questions</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="vbe_tutorial_groundstate.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Variational Basis State Encoder (Ground State)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, The TenCirChem Authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Variational Basis State Encoder (Time Dependent)</a><ul>
<li><a class="reference internal" href="#1-Background">1 Background</a></li>
<li><a class="reference internal" href="#2-Algorithm-Realization">2 Algorithm Realization</a><ul>
<li><a class="reference internal" href="#2.1-Imports">2.1 Imports</a></li>
<li><a class="reference internal" href="#2.2-Initialize">2.2 Initialize</a></li>
<li><a class="reference internal" href="#2.3-Get-variational-Hamiltonian-ansatz-terms">2.3 Get variational Hamiltonian ansatz terms</a></li>
<li><a class="reference internal" href="#2.4-Time-Evolution">2.4 Time Evolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.5-Main-Structure-of-the-Function">2.5 Main Structure of the Function</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>