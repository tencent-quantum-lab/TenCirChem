<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Variational Basis State Encoder (Time Dependent)" href="vbe_tutorial_td.html" /><link rel="prev" title="Observing Marcus Inverted Region" href="marcus.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2023.09.10 -->
        <title>Variational Basis State Encoder (Ground State) - TenCirChem documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">TenCirChem  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logov0.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">Advanced Topics</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ucc_functions.html">UCC Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="h2o_pes.html">Potential Energy Surface of the Water Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="adapt_vqe.html">ADAPT VQE</a></li>
<li class="toctree-l2"><a class="reference internal" href="engine_benchmark.html">Benchmark engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="hubbard_model.html">Hubbard Model by UCCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="noisy_simulation.html">Noisy Circuit Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sbm_dynamics.html">Dynamics of the Spin-Boson Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="marcus.html">Observing Marcus Inverted Region</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Variational Basis State Encoder (Ground State)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vbe_tutorial_td.html">Variational Basis State Encoder (Time Dependent)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/uccsd.html">UCCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/kupccgsd.html">k-UpCCGSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/puccd.html">Paired UCCD (pUCCD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/ucc.html">UCC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/hea.html">Headware-Efficient Ansatz and Noisy Circuit Simulation</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Variational-Basis-State-Encoder-(Ground-State)">
<h1>Variational Basis State Encoder (Ground State)<a class="headerlink" href="#Variational-Basis-State-Encoder-(Ground-State)" title="Permalink to this heading">#</a></h1>
<section id="1-Backgroud">
<h2>1 Backgroud<a class="headerlink" href="#1-Backgroud" title="Permalink to this heading">#</a></h2>
<p>This tutorial is for variational basis state encoder (VBE) for the ground state of the Holstein model.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{H} = -\sum_{i,j} V \hat{a}_i^\dagger \hat{a}_j + \sum_i \omega \hat{b}_i^\dagger \hat{b}_i + \sum_i g\omega \hat{a} _i^\dagger \hat{a}_i (\hat{b}_i^\dagger + \hat{b}_i)\]</div>
</div>
<p>To calculate the ground state of Holstein model accurately, many levels of phonons are needed, which will cost too many qubits in quantum circuit. There exists another idea that we can view linear conbination of phonons as an effective phonon mode, which is possible to save the qubits in phonon encoding:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{B}[l]=\sum_{n=1}^{2^{N_l}} \ket{n}_l\sum_m C[l]_{mn} \bra{m}_l\]</div>
</div>
<p>Here, we transform the original phonon basis <span class="math notranslate nohighlight">\(\ket{m}\)</span> to the encoded basis <span class="math notranslate nohighlight">\(\ket{n}\)</span>, via transformation operator <span class="math notranslate nohighlight">\(\hat{B}[l]\)</span>. The form of <span class="math notranslate nohighlight">\(\hat{B}[l]\)</span> is the central of VBE and the algorithm are presented in section 2. For more details, see <a class="reference external" href="https://doi.org/10.1103/PhysRevResearch.5.023046">https://doi.org/10.1103/PhysRevResearch.5.023046</a></p>
</section>
<section id="2-Algorithm-Realization">
<h2>2 Algorithm Realization<a class="headerlink" href="#2-Algorithm-Realization" title="Permalink to this heading">#</a></h2>
<section id="2.1-Imports">
<h3>2.1 Imports<a class="headerlink" href="#2.1-Imports" title="Permalink to this heading">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">opt_einsum</span> <span class="kn">import</span> <span class="n">contract</span>
<span class="kn">import</span> <span class="nn">tensorcircuit</span> <span class="k">as</span> <span class="nn">tc</span>

<span class="kn">from</span> <span class="nn">tencirchem</span> <span class="kn">import</span> <span class="n">set_backend</span><span class="p">,</span> <span class="n">Op</span><span class="p">,</span> <span class="n">BasisSHO</span><span class="p">,</span> <span class="n">BasisSimpleElectron</span><span class="p">,</span> <span class="n">Mpo</span><span class="p">,</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tencirchem.dynamic</span> <span class="kn">import</span> <span class="n">get_ansatz</span><span class="p">,</span> <span class="n">qubit_encode_op</span><span class="p">,</span> <span class="n">qubit_encode_basis</span>
<span class="kn">from</span> <span class="nn">tencirchem.utils</span> <span class="kn">import</span> <span class="n">scipy_opt_wrap</span>
<span class="kn">from</span> <span class="nn">tencirchem.applications.vbe_lib</span> <span class="kn">import</span> <span class="n">get_psi_indices</span><span class="p">,</span> <span class="n">get_contracted_mpo</span><span class="p">,</span> <span class="n">get_contract_args</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="2.2-Initial-setups">
<h2>2.2 Initial setups<a class="headerlink" href="#2.2-Initial-setups" title="Permalink to this heading">#</a></h2>
<p>In this section, we set intital parameters for coming sections. Here, <code class="docutils literal notranslate"><span class="pre">JAX</span></code> is used as backend. <code class="docutils literal notranslate"><span class="pre">nsite</span></code>, <code class="docutils literal notranslate"><span class="pre">omega</span></code>, <code class="docutils literal notranslate"><span class="pre">v</span></code> correspond to the site number, phonon frequency <span class="math notranslate nohighlight">\(\omega\)</span>, transfer intergral <span class="math notranslate nohighlight">\(V\)</span> in Holstein model, respectively:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{H} = -\sum_{i,j} V \hat{a}_i^\dagger \hat{a}_j + \sum_i \omega \hat{b}_i^\dagger \hat{b}_i + \sum_i g\omega \hat{a} _i^\dagger \hat{a}_i (\hat{b}_i^\dagger + \hat{b}_i)\]</div>
</div>
<p>Each site possesses one phonon mode, which is represented by 2 qubit per phonon (see <code class="docutils literal notranslate"><span class="pre">n_qubit_per_mode</span></code>). Considering gray encoding is adopted, the number of phonon basis (<code class="docutils literal notranslate"><span class="pre">nbas_v</span></code>) is <span class="math notranslate nohighlight">\(2^2\)</span>. <code class="docutils literal notranslate"><span class="pre">psi_index_top</span></code> and <code class="docutils literal notranslate"><span class="pre">psi_index_bottom</span></code> correspond to the physical index of ket and bra, <code class="docutils literal notranslate"><span class="pre">b_dof_vidx</span></code> correspond to the qubits that need VBE, <code class="docutils literal notranslate"><span class="pre">psi_shape2</span></code> is the physical bond dimension of each qubit state. The stucture of wavefunction and operator are presented in Fig.1. Note that the
related arguments and functions are also marked. <img alt="fig1" src="../_images/vbe_gs_Fig1.svg" /> Fig. 1 The structure of wavefunction and operator. Blue squares correspond to qubit representing spin, green circles correspond to qubits representing vibrations, purple circles correspond to <span class="math notranslate nohighlight">\(B[l]\)</span>, and orange squares correspond to Matrix Product Operators (MPO).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;jax&quot;</span><span class="p">)</span>

<span class="n">nsite</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># two qubit for each mode</span>
<span class="c1"># modify param_ids before modifying this</span>
<span class="n">n_qubit_per_mode</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nbas_v</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n_qubit_per_mode</span>

<span class="c1"># -1 for electron dof, natural numbers for phonon dof</span>
<span class="n">dof_nature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="c1"># physical index for phonon mode</span>
<span class="n">b_dof_pidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="n">psi_idx_top</span><span class="p">,</span> <span class="n">psi_idx_bottom</span><span class="p">,</span> <span class="n">b_dof_vidx</span> <span class="o">=</span> <span class="n">get_psi_indices</span><span class="p">(</span><span class="n">dof_nature</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">)</span>

<span class="n">n_dof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dof_nature</span><span class="p">)</span>
<span class="n">psi_shape2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_dof</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;psi_index_top: &quot;</span><span class="p">,</span>
    <span class="n">psi_idx_bottom</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> psi_index_bottom: &quot;</span><span class="p">,</span>
    <span class="n">psi_idx_bottom</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> b_dof_vidx: &quot;</span><span class="p">,</span>
    <span class="n">b_dof_vidx</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> psi_shape2: &quot;</span><span class="p">,</span>
    <span class="n">psi_shape2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">Circuit</span><span class="p">(</span><span class="n">nsite</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># generate quantum circuit</span>
<span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># prepare one-electron initial state</span>
<span class="n">n_layers</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># layers of ansatz</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-08-08 15:44:36.794994: E external/org_tensorflow/tensorflow/compiler/xla/stream_executor/cuda/cuda_driver.cc:267] failed call to cuInit: CUDA_ERROR_NO_DEVICE: no CUDA-capable device is detected
WARNING:jax._src.lib.xla_bridge:No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
psi_index_top:  [&#39;p-0-bottom&#39;, &#39;v-1-0-bottom&#39;, &#39;v-1-1-bottom&#39;, &#39;p-2-bottom&#39;, &#39;v-3-0-bottom&#39;, &#39;v-3-1-bottom&#39;, &#39;p-4-bottom&#39;, &#39;v-5-0-bottom&#39;, &#39;v-5-1-bottom&#39;]
 psi_index_bottom:  [&#39;p-0-bottom&#39;, &#39;v-1-0-bottom&#39;, &#39;v-1-1-bottom&#39;, &#39;p-2-bottom&#39;, &#39;v-3-0-bottom&#39;, &#39;v-3-1-bottom&#39;, &#39;p-4-bottom&#39;, &#39;v-5-0-bottom&#39;, &#39;v-5-1-bottom&#39;]
 b_dof_vidx:  [array([1, 2]), array([4, 5]), array([7, 8])]
 psi_shape2:  [2, 2, 2, 2, 2, 2, 2, 2, 2]
</pre></div></div>
</div>
</section>
<section id="2.3-Get-Variational-Hamiltonian-Ansatz-(VHA)-Terms">
<h2>2.3 Get Variational Hamiltonian Ansatz (VHA) Terms<a class="headerlink" href="#2.3-Get-Variational-Hamiltonian-Ansatz-(VHA)-Terms" title="Permalink to this heading">#</a></h2>
<p>In this section, we will generate variational hamiltonian ansatz terms. The following ansatz is adopted:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\ket{\phi}=\prod_l^L {\prod_{&lt;j,k&gt;} e^{\theta_{ijk} {(\hat{a}_j^\dagger \hat{a}_k - \hat{a}_k^\dagger \hat{a}_j)}}
\prod_j {e^{\theta_{lj}\hat{a}_j^\dagger \hat{a}_j (\hat{b}_j^\dagger - \hat{b}_j)}}} \ket{\phi_0}\]</div>
</div>
<p>The anasatz is transformed from electron-phonon basis to qubit basis through <code class="docutils literal notranslate"><span class="pre">qubit_encode_op()</span></code> and <code class="docutils literal notranslate"><span class="pre">qubit_encode_basis()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_vha_terms</span><span class="p">():</span>
    <span class="c1"># variational Hamiltonian ansatz (vha) terms</span>

    <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># dummy value, doesn&#39;t matter</span>
    <span class="n">ansatz_terms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsite</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">nsite</span>
        <span class="n">ansatz_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a^\dagger a&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">ansatz_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a^\dagger a&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">))</span>
        <span class="n">ansatz_terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a^\dagger a b^\dagger-b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">g</span> <span class="o">*</span> <span class="n">omega</span><span class="p">))</span>

    <span class="n">basis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsite</span><span class="p">):</span>
        <span class="n">basis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BasisSimpleElectron</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">basis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BasisSHO</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">omega</span><span class="p">,</span> <span class="n">nbas_v</span><span class="p">))</span>

    <span class="n">ansatz_terms</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qubit_encode_op</span><span class="p">(</span><span class="n">ansatz_terms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">boson_encoding</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">spin_basis</span> <span class="o">=</span> <span class="n">qubit_encode_basis</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">boson_encoding</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="c1"># this is currently hard-coded for `n_qubit_per_mode==2`</span>
    <span class="c1"># if the values of param_ids are opposite to each other, the values of the parameters are forced to be opposite in the optimization.</span>
    <span class="n">param_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="o">-</span><span class="mi">18</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">27</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ansatz_terms</span><span class="p">,</span> <span class="n">spin_basis</span><span class="p">,</span> <span class="n">param_ids</span>


<span class="n">ansatz_terms</span><span class="p">,</span> <span class="n">spin_basis</span><span class="p">,</span> <span class="n">param_ids</span> <span class="o">=</span> <span class="n">get_vha_terms</span><span class="p">()</span>
<span class="n">ansatz</span> <span class="o">=</span> <span class="n">get_ansatz</span><span class="p">(</span><span class="n">ansatz_terms</span><span class="p">,</span> <span class="n">spin_basis</span><span class="p">,</span> <span class="n">n_layers</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">param_ids</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;ansatz_terms: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">ansatz_terms</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">spin_basis: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">spin_basis</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">param_ids: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">param_ids</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ansatz: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">ansatz</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ansatz_terms:
 [Op(&#39;X Y&#39;, [0, 1], 0.5j), Op(&#39;Y X&#39;, [0, 1], -0.5j), Op(&#39;Y&#39;, [((0, 0), &#39;TCCQUBIT-1&#39;)], 0.1830127018922193j), Op(&#39;Z Y&#39;, [((0, 0), &#39;TCCQUBIT-0&#39;), ((0, 0), &#39;TCCQUBIT-1&#39;)], -0.6830127018922193j), Op(&#39;Y&#39;, [((0, 0), &#39;TCCQUBIT-0&#39;)], -0.3535533905932738j), Op(&#39;Y Z&#39;, [((0, 0), &#39;TCCQUBIT-0&#39;), ((0, 0), &#39;TCCQUBIT-1&#39;)], 0.3535533905932738j), Op(&#39;Z Y&#39;, [0, ((0, 0), &#39;TCCQUBIT-1&#39;)], -0.1830127018922193j), Op(&#39;Z Z Y&#39;, [0, ((0, 0), &#39;TCCQUBIT-0&#39;), ((0, 0), &#39;TCCQUBIT-1&#39;)], 0.6830127018922193j), Op(&#39;Z Y&#39;, [0, ((0, 0), &#39;TCCQUBIT-0&#39;)], 0.3535533905932738j), Op(&#39;Z Y Z&#39;, [0, ((0, 0), &#39;TCCQUBIT-0&#39;), ((0, 0), &#39;TCCQUBIT-1&#39;)], -0.3535533905932738j), Op(&#39;X Y&#39;, [1, 2], 0.5j), Op(&#39;Y X&#39;, [1, 2], -0.5j), Op(&#39;Y&#39;, [((1, 0), &#39;TCCQUBIT-1&#39;)], 0.1830127018922193j), Op(&#39;Z Y&#39;, [((1, 0), &#39;TCCQUBIT-0&#39;), ((1, 0), &#39;TCCQUBIT-1&#39;)], -0.6830127018922193j), Op(&#39;Y&#39;, [((1, 0), &#39;TCCQUBIT-0&#39;)], -0.3535533905932738j), Op(&#39;Y Z&#39;, [((1, 0), &#39;TCCQUBIT-0&#39;), ((1, 0), &#39;TCCQUBIT-1&#39;)], 0.3535533905932738j), Op(&#39;Z Y&#39;, [1, ((1, 0), &#39;TCCQUBIT-1&#39;)], -0.1830127018922193j), Op(&#39;Z Z Y&#39;, [1, ((1, 0), &#39;TCCQUBIT-0&#39;), ((1, 0), &#39;TCCQUBIT-1&#39;)], 0.6830127018922193j), Op(&#39;Z Y&#39;, [1, ((1, 0), &#39;TCCQUBIT-0&#39;)], 0.3535533905932738j), Op(&#39;Z Y Z&#39;, [1, ((1, 0), &#39;TCCQUBIT-0&#39;), ((1, 0), &#39;TCCQUBIT-1&#39;)], -0.3535533905932738j), Op(&#39;X Y&#39;, [0, 2], -0.5j), Op(&#39;Y X&#39;, [0, 2], 0.5j), Op(&#39;Y&#39;, [((2, 0), &#39;TCCQUBIT-1&#39;)], 0.1830127018922193j), Op(&#39;Z Y&#39;, [((2, 0), &#39;TCCQUBIT-0&#39;), ((2, 0), &#39;TCCQUBIT-1&#39;)], -0.6830127018922193j), Op(&#39;Y&#39;, [((2, 0), &#39;TCCQUBIT-0&#39;)], -0.3535533905932738j), Op(&#39;Y Z&#39;, [((2, 0), &#39;TCCQUBIT-0&#39;), ((2, 0), &#39;TCCQUBIT-1&#39;)], 0.3535533905932738j), Op(&#39;Z Y&#39;, [2, ((2, 0), &#39;TCCQUBIT-1&#39;)], -0.1830127018922193j), Op(&#39;Z Z Y&#39;, [2, ((2, 0), &#39;TCCQUBIT-0&#39;), ((2, 0), &#39;TCCQUBIT-1&#39;)], 0.6830127018922193j), Op(&#39;Z Y&#39;, [2, ((2, 0), &#39;TCCQUBIT-0&#39;)], 0.3535533905932738j), Op(&#39;Z Y Z&#39;, [2, ((2, 0), &#39;TCCQUBIT-0&#39;), ((2, 0), &#39;TCCQUBIT-1&#39;)], -0.3535533905932738j)]
spin_basis:
 [BasisHalfSpin(dof: 0, nbas: 2), BasisHalfSpin(dof: ((0, 0), &#39;TCCQUBIT-0&#39;), nbas: 2), BasisHalfSpin(dof: ((0, 0), &#39;TCCQUBIT-1&#39;), nbas: 2), BasisHalfSpin(dof: 1, nbas: 2), BasisHalfSpin(dof: ((1, 0), &#39;TCCQUBIT-0&#39;), nbas: 2), BasisHalfSpin(dof: ((1, 0), &#39;TCCQUBIT-1&#39;), nbas: 2), BasisHalfSpin(dof: 2, nbas: 2), BasisHalfSpin(dof: ((2, 0), &#39;TCCQUBIT-0&#39;), nbas: 2), BasisHalfSpin(dof: ((2, 0), &#39;TCCQUBIT-1&#39;), nbas: 2)]
param_ids:
 [1, -1, 0, 2, 3, 4, 5, 6, 7, 8, 9, -9, 10, 11, 12, 13, 14, 15, 16, 17, 18, -18, 19, 20, 21, 22, 23, 24, 25, 26]
ansatz:
 &lt;function get_ansatz.&lt;locals&gt;.ansatz at 0x7f2fd4ed29e0&gt;
</pre></div></div>
</div>
</section>
<section id="2.4-Cost-Functions-for-VQE-Part">
<h2>2.4 Cost Functions for VQE Part<a class="headerlink" href="#2.4-Cost-Functions-for-VQE-Part" title="Permalink to this heading">#</a></h2>
<p>The VQE parameters <span class="math notranslate nohighlight">\(\theta_k\)</span> are optimized via following equation:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\partial {\bra{\phi}\hat{H}_1\ket{\phi}}/\partial {\theta_k} = 0\]</div>
</div>
<p>where</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{H}_1=\prod_{l}\hat{B}[l] \hat{H} \prod_{l}\hat{B}[l]^\dagger\]</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cost_fn</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">@</span> <span class="p">(</span><span class="n">h</span> <span class="o">@</span> <span class="n">state</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">real</span>


<span class="n">vg</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">value_and_grad</span><span class="p">(</span><span class="n">cost_fn</span><span class="p">))</span>
<span class="n">opt_fn</span> <span class="o">=</span> <span class="n">scipy_opt_wrap</span><span class="p">(</span><span class="n">vg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.5-Get-Hamiltonian-Terms-and-Basis">
<h2>2.5 Get Hamiltonian Terms and Basis<a class="headerlink" href="#2.5-Get-Hamiltonian-Terms-and-Basis" title="Permalink to this heading">#</a></h2>
<p>In this section, we generate the operator of the Holstein Hamiltonian presented in Section 2.2. The format of the operator are shown in Fig. 1. Note that the number of phonon levels are controlled by <code class="docutils literal notranslate"><span class="pre">nbas</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_ham_terms_and_basis</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">nbas</span><span class="p">):</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsite</span><span class="p">):</span>
        <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;b^\dagger b&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">omega</span><span class="p">))</span>
        <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a^\dagger a b^\dagger+b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">g</span> <span class="o">*</span> <span class="n">omega</span><span class="p">))</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">nsite</span>
        <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a^\dagger a&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">))</span>
        <span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Op</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;a^\dagger a&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="n">v</span><span class="p">))</span>

    <span class="n">basis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsite</span><span class="p">):</span>
        <span class="n">basis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BasisSimpleElectron</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">basis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BasisSHO</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">omega</span><span class="p">,</span> <span class="n">nbas</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">terms</span><span class="p">,</span> <span class="n">basis</span>
</pre></div>
</div>
</div>
</section>
<section id="2.6-Update-B[l]-in-Iteration">
<h2>2.6 Update <span class="math notranslate nohighlight">\(B[l]\)</span> in Iteration<a class="headerlink" href="#2.6-Update-B[l]-in-Iteration" title="Permalink to this heading">#</a></h2>
<p>In this section, the function that calculates <span class="math notranslate nohighlight">\(B[l]\)</span> are defined:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[(1-\hat{P}[l])\bra{\phi}\tilde{H'}\ket{\phi}=0\]</div>
</div>
<p>where</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\hat{P}[l]=\hat{B}[l]^\dagger\hat{B}[l]\]</div>
</div>
<p>and</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\tilde{H'}=\hat{H}_{contracted}\hat{B}[l]^\dagger=\left( \prod_{k\neq l}\hat{B}[l] \hat{H} \prod_{k\neq l}\hat{B}[k]^\dagger \right) \hat{B}[l]^\dagger\]</div>
</div>
<p>The graphic representarion of <code class="docutils literal notranslate"><span class="pre">h_contracted</span></code> is presented in Fig. 2. Obiviously, if <span class="math notranslate nohighlight">\(\hat{H}\)</span> are provided, we can obtain <span class="math notranslate nohighlight">\(\hat{B}[l]\)</span> by solving the equation mentioned above. Considering this is a non-linear equation, several initial guesses are needed to avoid local minimum, which is controlled by <code class="docutils literal notranslate"><span class="pre">nroot</span></code>. <img alt="fig2" src="../_images/vbe_gs_Fig2.svg" /> Fig. 2 Graphic representation of <code class="docutils literal notranslate"><span class="pre">h_contracted</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve_b_array</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">nbas</span> <span class="o">=</span> <span class="n">b_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># get the input of tensor contraction function `contract`</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">get_contract_args</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">psi_idx_top</span><span class="p">,</span> <span class="n">psi_idx_bottom</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">b_dof_pidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1"># output indices</span>
    <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-0-bottom&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-1-bottom&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;p-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-bottom&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-0-top&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;v-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-1-top&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;p-</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-top&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mpo-0&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;mpo-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">h_mpo</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># get contracted_h and reshape the dofs named v-{k}-0-bottom(top) and v-{k}-1-bottom(top) to one dof with dimension 4</span>
    <span class="n">contracted_h</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">nbas</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>
    <span class="n">nroot</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nroot</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>
        <span class="c1"># calculate P[l]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s2">&quot;abc, abd -&gt; acd&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">conj</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contract</span><span class="p">(</span><span class="s2">&quot;abcd, kab, kde -&gt; kce&quot;</span><span class="p">,</span> <span class="n">contracted_h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nbas</span><span class="p">)]</span> <span class="o">*</span> <span class="n">nroot</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># solve the equation mentioned above to obtain B[l]</span>
    <span class="n">sols</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span> <span class="o">*</span> <span class="n">nroot</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;df-sane&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>

    <span class="n">sols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sols</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
    <span class="n">b_array</span> <span class="o">=</span> <span class="n">b_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">es</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">new_b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sols</span><span class="p">):</span>
        <span class="c1"># ensure the orthomormal constraint of B[l]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">new_b</span> <span class="o">@</span> <span class="n">new_b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)):</span>
            <span class="c1"># print(f&quot;Enforcing orthogonality for the {k}th root of b_array[{i}]&quot;)</span>
            <span class="n">new_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">new_b</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_b</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">psi</span> <span class="o">@</span> <span class="n">get_contracted_mpo</span><span class="p">(</span><span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">,</span> <span class="n">psi_idx_top</span> <span class="o">+</span> <span class="n">psi_idx_bottom</span><span class="p">)</span> <span class="o">@</span> <span class="n">psi</span>
        <span class="n">es</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c1"># print(np.array(es))</span>
    <span class="n">lowest_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sols</span><span class="p">[</span><span class="n">lowest_id</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="2.7-Main-Structure-of-the-Function">
<h2>2.7 Main Structure of the Function<a class="headerlink" href="#2.7-Main-Structure-of-the-Function" title="Permalink to this heading">#</a></h2>
<p>This section is the main part of the funtion. The codes contain following parts: (i) Initialize the parameters and functions, some initializations are also preformed in section 2.2 (ii) Search for ground state, where <span class="math notranslate nohighlight">\(\theta_k\)</span> are updated via VQE and <span class="math notranslate nohighlight">\(B[l]\)</span> are calculated via functions in Section 2.6.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vqe_e</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">param_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_layers</span><span class="p">)</span>

<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">nbas</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">32</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;g: </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">, nbas: </span><span class="si">{</span><span class="n">nbas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># take gray encoding as an initial guess for `b_array`</span>
        <span class="n">b_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dof_nature</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nbas</span><span class="p">)[:</span><span class="n">nbas_v</span><span class="p">]</span>  <span class="c1"># nbas_dummy * nbas</span>
            <span class="n">b_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">b_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_list</span><span class="p">)</span>

        <span class="c1"># initialize, get hamitonians and basis, see section 2.5</span>
        <span class="n">terms</span><span class="p">,</span> <span class="n">basis</span> <span class="o">=</span> <span class="n">get_ham_terms_and_basis</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">nbas</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
        <span class="n">h_mpo</span> <span class="o">=</span> <span class="n">Mpo</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># searching for the ground state.</span>
        <span class="k">for</span> <span class="n">i_iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">h_contracted</span> <span class="o">=</span> <span class="n">get_contracted_mpo</span><span class="p">(</span>
                <span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">n_qubit_per_mode</span><span class="p">,</span> <span class="n">b_dof_pidx</span><span class="p">,</span> <span class="n">psi_idx_top</span> <span class="o">+</span> <span class="n">psi_idx_bottom</span>
            <span class="p">)</span>
            <span class="c1"># get \theta_k via VQE</span>
            <span class="n">opt_res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">opt_fn</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">h_contracted</span><span class="p">,),</span> <span class="n">x0</span><span class="o">=</span><span class="n">thetas</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iter </span><span class="si">{</span><span class="n">i_iter</span><span class="si">}</span><span class="s2"> VQE energy: </span><span class="si">{</span><span class="n">opt_res</span><span class="o">.</span><span class="n">fun</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">thetas</span> <span class="o">=</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">x</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">ansatz</span><span class="p">(</span><span class="n">thetas</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
            <span class="c1"># Update b[l] via functions in section 2.6</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b_array</span><span class="p">)):</span>
                <span class="n">b_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">solve_b_array</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">h_mpo</span><span class="p">,</span> <span class="n">b_array</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">vqe_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt_res</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">vqe_e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
g: 1.5, nbas: 4
Iter 0 VQE energy: -3.1462862688238387
Iter 1 VQE energy: -3.1467101393155392
Iter 2 VQE energy: -3.1516072207104755
Iter 3 VQE energy: -3.146809472707097
Iter 4 VQE energy: -3.1436199703762058
Iter 5 VQE energy: -3.1436211792549265
Iter 6 VQE energy: -3.1436161320531255
Iter 7 VQE energy: -3.1436163145946456
Iter 8 VQE energy: -3.143610688816215
Iter 9 VQE energy: -3.143615904093609
g: 1.5, nbas: 8
Iter 0 VQE energy: -3.143618182488605
Iter 1 VQE energy: -3.200840457440427
Iter 2 VQE energy: -3.2122982581916806
Iter 3 VQE energy: -3.2148415941913107
Iter 4 VQE energy: -3.214454540682066
Iter 5 VQE energy: -3.214612010154128
Iter 6 VQE energy: -3.2147110746262615
Iter 7 VQE energy: -3.2147665497225395
Iter 8 VQE energy: -3.2148131940534586
Iter 9 VQE energy: -3.2154252365889784
g: 1.5, nbas: 12
Iter 0 VQE energy: -3.1514261568965116
Iter 1 VQE energy: -3.207712921399021
Iter 2 VQE energy: -3.2143507766993564
Iter 3 VQE energy: -3.2151165867343625
Iter 4 VQE energy: -3.215551620056812
Iter 5 VQE energy: -3.21568849222177
Iter 6 VQE energy: -3.215871719331443
Iter 7 VQE energy: -3.215941510624362
Iter 8 VQE energy: -3.2160628060732046
Iter 9 VQE energy: -3.216149074896171
g: 1.5, nbas: 16
Iter 0 VQE energy: -3.1514406055444124
Iter 1 VQE energy: -3.2076420281600306
Iter 2 VQE energy: -3.2142584040499904
Iter 3 VQE energy: -3.215027472815238
Iter 4 VQE energy: -3.215298468441994
Iter 5 VQE energy: -3.215473370191188
Iter 6 VQE energy: -3.215603547226202
Iter 7 VQE energy: -3.2157277687243084
Iter 8 VQE energy: -3.21585866940053
Iter 9 VQE energy: -3.215945718302776
g: 1.5, nbas: 20
Iter 0 VQE energy: -3.1514390786099793
Iter 1 VQE energy: -3.207490813088342
Iter 2 VQE energy: -3.214102161196929
Iter 3 VQE energy: -3.2148182787029125
Iter 4 VQE energy: -3.215041112156586
Iter 5 VQE energy: -3.2151813495719064
Iter 6 VQE energy: -3.2153433350190888
Iter 7 VQE energy: -3.215488882659097
Iter 8 VQE energy: -3.2156246556276216
Iter 9 VQE energy: -3.2157174737499026
g: 1.5, nbas: 24
Iter 0 VQE energy: -3.1514387774077157
Iter 1 VQE energy: -3.207367390115564
Iter 2 VQE energy: -3.2139409419868894
Iter 3 VQE energy: -3.214681092894311
Iter 4 VQE energy: -3.2148647347163752
Iter 5 VQE energy: -3.2149976397508198
Iter 6 VQE energy: -3.2150898148896068
Iter 7 VQE energy: -3.215209498240965
Iter 8 VQE energy: -3.215350330348768
Iter 9 VQE energy: -3.215489480343017
g: 1.5, nbas: 28
Iter 0 VQE energy: -3.151439525393469
Iter 1 VQE energy: -3.2073726435058725
Iter 2 VQE energy: -3.21394347501351
Iter 3 VQE energy: -3.2146357208139835
Iter 4 VQE energy: -3.2147953021340396
Iter 5 VQE energy: -3.2149183613661005
Iter 6 VQE energy: -3.2150120210391324
Iter 7 VQE energy: -3.2151326321686358
Iter 8 VQE energy: -3.2152609684807225
Iter 9 VQE energy: -3.2153772130446274
g: 1.5, nbas: 32
Iter 0 VQE energy: -3.1514407536942515
Iter 1 VQE energy: -3.2073747584311443
Iter 2 VQE energy: -3.213913960989289
Iter 3 VQE energy: -3.214575999427622
Iter 4 VQE energy: -3.2147908760265476
Iter 5 VQE energy: -3.214908337484859
Iter 6 VQE energy: -3.214995903540079
Iter 7 VQE energy: -3.2151048002575178
Iter 8 VQE energy: -3.2151780903906246
Iter 9 VQE energy: -3.215267190685132
[array(-3.1436159), array(-3.21542524), array(-3.21614907), array(-3.21594572), array(-3.21571747), array(-3.21548948), array(-3.21537721), array(-3.21526719)]
g: 3, nbas: 4
Iter 0 VQE energy: -5.970388609022889
Iter 1 VQE energy: -5.970388750660544
Iter 2 VQE energy: -5.970380747881972
Iter 3 VQE energy: -5.9703823363984405
Iter 4 VQE energy: -5.970361506210726
Iter 5 VQE energy: -5.970387322685639
Iter 6 VQE energy: -5.970395203902614
Iter 7 VQE energy: -5.970391647335198
Iter 8 VQE energy: -5.970399166505385
Iter 9 VQE energy: -5.970381692433662
g: 3, nbas: 8
Iter 0 VQE energy: -5.97038378078057
Iter 1 VQE energy: -7.5564103165274705
Iter 2 VQE energy: -7.867598000881585
Iter 3 VQE energy: -7.886883542215796
Iter 4 VQE energy: -7.8885422575017525
Iter 5 VQE energy: -7.88860270448971
Iter 6 VQE energy: -7.888976697629529
Iter 7 VQE energy: -7.889032282397925
Iter 8 VQE energy: -7.87508588628647
Iter 9 VQE energy: -7.88070265416792
g: 3, nbas: 12
Iter 0 VQE energy: -5.97067566818566
Iter 1 VQE energy: -8.243806185428152
Iter 2 VQE energy: -8.734803721364637
Iter 3 VQE energy: -8.761741304437681
Iter 4 VQE energy: -8.763332322992516
Iter 5 VQE energy: -8.763771458365108
Iter 6 VQE energy: -8.764185047602272
Iter 7 VQE energy: -8.764384932213805
Iter 8 VQE energy: -8.76466850977698
Iter 9 VQE energy: -8.764911481717341
g: 3, nbas: 16
Iter 0 VQE energy: -5.96862038743091
Iter 1 VQE energy: -8.429794930919833
Iter 2 VQE energy: -9.026873692202507
Iter 3 VQE energy: -9.056442107809515
Iter 4 VQE energy: -9.05694061960338
Iter 5 VQE energy: -9.057045669005818
Iter 6 VQE energy: -9.057238086937822
Iter 7 VQE energy: -9.057282106387905
Iter 8 VQE energy: -9.057566284361702
Iter 9 VQE energy: -9.057828042375913
g: 3, nbas: 20
Iter 0 VQE energy: -5.970618486961766
Iter 1 VQE energy: -8.46027786865908
Iter 2 VQE energy: -9.083147656265663
Iter 3 VQE energy: -9.114099808352503
Iter 4 VQE energy: -9.11560775880261
Iter 5 VQE energy: -9.115877265080734
Iter 6 VQE energy: -9.116097672280478
Iter 7 VQE energy: -9.116229576435904
Iter 8 VQE energy: -9.116393057481334
Iter 9 VQE energy: -9.116547264265742
g: 3, nbas: 24
Iter 0 VQE energy: -5.970625270862546
Iter 1 VQE energy: -8.45711233270321
Iter 2 VQE energy: -9.088394950174024
Iter 3 VQE energy: -9.119585611496353
Iter 4 VQE energy: -9.120622157156225
Iter 5 VQE energy: -9.12076874586676
Iter 6 VQE energy: -9.120868946965105
Iter 7 VQE energy: -9.120961208842665
Iter 8 VQE energy: -9.121266704999321
Iter 9 VQE energy: -9.121400092721187
g: 3, nbas: 28
Iter 0 VQE energy: -5.970428599007128
Iter 1 VQE energy: -8.457873653767907
Iter 2 VQE energy: -9.080983847442083
Iter 3 VQE energy: -9.11887015866691
Iter 4 VQE energy: -9.120581625216305
Iter 5 VQE energy: -9.120780165844552
Iter 6 VQE energy: -9.120861448711434
Iter 7 VQE energy: -9.120944883939789
Iter 8 VQE energy: -9.121064294222425
Iter 9 VQE energy: -9.121158073032065
g: 3, nbas: 32
Iter 0 VQE energy: -5.969871735326939
Iter 1 VQE energy: -8.45468700588645
Iter 2 VQE energy: -9.081070798150298
Iter 3 VQE energy: -9.11871782591465
Iter 4 VQE energy: -9.120482174048545
Iter 5 VQE energy: -9.1206758213174
Iter 6 VQE energy: -9.12076495864178
Iter 7 VQE energy: -9.12087305152589
Iter 8 VQE energy: -9.120974560170358
Iter 9 VQE energy: -9.121128971234404
[array(-3.1436159), array(-3.21542524), array(-3.21614907), array(-3.21594572), array(-3.21571747), array(-3.21548948), array(-3.21537721), array(-3.21526719), array(-5.97038169), array(-7.88070265), array(-8.76491148), array(-9.05782804), array(-9.11654726), array(-9.12140009), array(-9.12115807), array(-9.12112897)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the results</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">nbas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">nbas</span><span class="p">,</span> <span class="n">vqe_e</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;g=1.5&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">nbas</span><span class="p">,</span> <span class="n">vqe_e</span><span class="p">[</span><span class="mi">8</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;g=3.0&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Phonon Levels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Energy&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_jupyter_vbe_tutorial_groundstate_17_1.png" src="../_images/tutorial_jupyter_vbe_tutorial_groundstate_17_1.png" />
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="vbe_tutorial_td.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Variational Basis State Encoder (Time Dependent)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="marcus.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Observing Marcus Inverted Region</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, The TenCirChem Authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Variational Basis State Encoder (Ground State)</a><ul>
<li><a class="reference internal" href="#1-Backgroud">1 Backgroud</a></li>
<li><a class="reference internal" href="#2-Algorithm-Realization">2 Algorithm Realization</a><ul>
<li><a class="reference internal" href="#2.1-Imports">2.1 Imports</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.2-Initial-setups">2.2 Initial setups</a></li>
<li><a class="reference internal" href="#2.3-Get-Variational-Hamiltonian-Ansatz-(VHA)-Terms">2.3 Get Variational Hamiltonian Ansatz (VHA) Terms</a></li>
<li><a class="reference internal" href="#2.4-Cost-Functions-for-VQE-Part">2.4 Cost Functions for VQE Part</a></li>
<li><a class="reference internal" href="#2.5-Get-Hamiltonian-Terms-and-Basis">2.5 Get Hamiltonian Terms and Basis</a></li>
<li><a class="reference internal" href="#2.6-Update-B[l]-in-Iteration">2.6 Update <span class="math notranslate nohighlight">\(B[l]\)</span> in Iteration</a></li>
<li><a class="reference internal" href="#2.7-Main-Structure-of-the-Function">2.7 Main Structure of the Function</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>