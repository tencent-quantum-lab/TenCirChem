<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API Reference" href="modules.html" /><link rel="prev" title="Observing Marcus Inverted Region" href="tutorial_jupyter/marcus.html" />

    <link rel="shortcut icon" href="_static/favicon.ico"/><!-- Generated with Sphinx 6.1.3 and Furo 2023.03.27 -->
        <title>Frequently Asked Questions - TenCirChem documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">TenCirChem  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logov0.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Topics</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/ucc_functions.html">UCC Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/h2o_pes.html">Potential Energy Surface of the Water Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/adapt_vqe.html">ADAPT VQE</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/engine_benchmark.html">Benchmark engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/hubbard_model.html">Hubbard Model by UCCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/noisy_simulation.html">Noisy Circuit Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/sbm_dynamics.html">Dynamics of the Spin-Boson Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_jupyter/marcus.html">Observing Marcus Inverted Region</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Frequently Asked Questions</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/uccsd.html">UCCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/kupccgsd.html">k-UpCCGSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/puccd.html">Paired UCCD (pUCCD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/ucc.html">UCC</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/hea.html">Headware-Efficient Ansatz and Noisy Circuit Simulation</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this heading">#</a></h1>
<section id="what-are-the-conventions-for-excitation-operators-integrals-orbital-indices">
<h2>What are the conventions for excitation operators/integrals/orbital indices…<a class="headerlink" href="#what-are-the-conventions-for-excitation-operators-integrals-orbital-indices" title="Permalink to this heading">#</a></h2>
<p>The convention for indices of excitation operators and qubit ordering is as follows:</p>
<ul class="simple">
<li><p>An excitation operator is represented by a tuple of integers. Each integer corresponds to one spin-orbital.</p></li>
<li><p>The first half of the tuple contains the indices for creation operator and the second half is for annilation operator.</p></li>
<li><p>Hermitian conjugation is handled internally.</p></li>
</ul>
<p>Or, <code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">2,</span> <span class="pre">0,</span> <span class="pre">4)</span></code> corresponds to <span class="math notranslate nohighlight">\(a^\dagger_6 a^\dagger_2 a_0 a_4 - a^\dagger_4 a^\dagger_0 a_2 a_6\)</span>.</p>
<p>Besides, the spin-orbitals are indexed from 0 and ordered according to the following rules</p>
<ul class="simple">
<li><p>Beta (down) spins first, followed by alpha (up) spins</p></li>
<li><p>Low energy orbitals first, followed by high energy orbitals</p></li>
</ul>
<p>Qubits are numbered from 0, with multiqubit registers numbered  with the zeroth qubit on the left,
e.g. <span class="math notranslate nohighlight">\(|0\rangle_{q_0} |1\rangle_{q_2} |0\rangle_{q_2}\)</span>.
In <code class="docutils literal notranslate"><span class="pre">UCC</span></code> classes, the occupancy of spin-orbital <span class="math notranslate nohighlight">\(i\)</span>
(using the above ordering) corresponds to the state of qubit <span class="math notranslate nohighlight">\(N - 1 - i\)</span> where <span class="math notranslate nohighlight">\(N\)</span> is the total number of qubits.
In other words, the qubit ordering is reversed spin-orbitals ordering.</p>
<p>This convention is best understood from a bitstring picture.
Each molecular orbital configuration can be represented as a bitstring in occupation number space.
For example, the HF state of <span class="math notranslate nohighlight">\(\rm{H}_4\)</span> can be represented as <code class="docutils literal notranslate"><span class="pre">00110011</span></code>.
Counting the bitstring from left to right gives the spin-orbital index.
An important reason for keeping the convention is to be consistent with <code class="docutils literal notranslate"><span class="pre">pyscf.fci.cistring</span></code>.</p>
<p>In short, the convention for excitation operators and spin-orbital indices can be summarized in the following figure:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/excitation.png"><img alt="_images/excitation.png" src="_images/excitation.png" style="width: 510.0px; height: 252.0px;" /></a>
</figure>
<p>Following the qubit indexing convention above, the restricted Hartree-Fock state for such a system is represented as 00110011 in bitstring form.
The highest orbital with <span class="math notranslate nohighlight">\(\alpha\)</span> spin comes first in the bitstring, and the lowest orbital with <span class="math notranslate nohighlight">\(\beta\)</span> spin comes last.
In quantum chemistry language, 00110011 refers to a configuration with orbitals 5, 4, 1, and 0 occupied,
while in quantum computating language, 00110011 refers to a direct product state
with the 2nd, 3rd, 6th, and 7th qubits in state <span class="math notranslate nohighlight">\(|1\rangle\)</span> and the rest in state <span class="math notranslate nohighlight">\(|0\rangle\)</span>.
Upon application of the excitation operator (6, 2, 0, 4), the HF state transforms to 01100110.</p>
<p>The integrals such as <code class="docutils literal notranslate"><span class="pre">ucc.int2e</span></code> are stored in the Chemists’ Notation <span class="math notranslate nohighlight">\((ij|kl)\)</span>
without considering symmetry.
Note that although in excitation operators the orbitals with the same spin are indexed from high-energy to low-energy,
in the integrals the orbitals are indexed from low-energy to high-energy.</p>
<p>In general, TenCirChem tries to match the convention of PySCF.
For example, the distance unit is angstrom,
and the configuration interaction vector can be fed into PySCF directly.</p>
<p>There’s also a naming convention for excitation operators in the source code.
Excitation operators in the bare tuple form are usually named as <code class="docutils literal notranslate"><span class="pre">ex_op</span></code>,
and after transformed to OpenFermion operator they are usually named as <code class="docutils literal notranslate"><span class="pre">fop</span></code>.</p>
</section>
<section id="why-are-the-number-of-excitation-operators-and-the-number-of-parameters-different-what-is-param-ids">
<h2>Why are the number of excitation operators and the number of parameters different?/What is <code class="docutils literal notranslate"><span class="pre">param_ids</span></code>?<a class="headerlink" href="#why-are-the-number-of-excitation-operators-and-the-number-of-parameters-different-what-is-param-ids" title="Permalink to this heading">#</a></h2>
<p>Some excitations share the same parameter due to symmetry.
For example, <code class="docutils literal notranslate"><span class="pre">1001</span></code> and <code class="docutils literal notranslate"><span class="pre">0110</span></code> configurations have the same amplitude.
Thus, <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">1)</span></code> and <code class="docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3)</span></code> excitations can use the same parameter.
This is why the number of excitation operators is usually larger than the number of parameters.</p>
<p><code class="docutils literal notranslate"><span class="pre">param_ids</span></code> is a list of integers that maps excitations to parameters, starting from 0.
Its size is the number of excitations, and its largest value plus one is the number of parameters.</p>
<p>This parameter sharing strategy improves VQE convergence and accuracy.
To disable it, try the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ucc</span><span class="o">.</span><span class="n">param_ids</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">ucc</span><span class="o">.</span><span class="n">init_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ucc</span><span class="o">.</span><span class="n">n_params</span><span class="p">)</span> <span class="c1"># n_params equals number of excitations</span>
</pre></div>
</div>
</section>
<section id="why-is-tencirchem-so-fast">
<h2>Why is TenCirChem so fast?<a class="headerlink" href="#why-is-tencirchem-so-fast" title="Permalink to this heading">#</a></h2>
<p>The speed of TenCirChem depends on the underlying engine.
For the <code class="docutils literal notranslate"><span class="pre">&quot;civector&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;civector-large&quot;</span></code> engines,
there are three main factors that makes them fast</p>
<ul class="simple">
<li><p>The quantum state is represented in CI space rather than the full Hilbert space.
Take the hydrogen molecule as an example. The four quit system has a dimension of <span class="math notranslate nohighlight">\(2^4=16\)</span>.
On the other hand, the possible configurations, constrained by the particle number in each spin sector,
are <code class="docutils literal notranslate"><span class="pre">&quot;0101&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;1001&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;0110&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;1010&quot;</span></code>,</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/configuration.png"><img alt="_images/configuration.png" src="_images/configuration.png" style="width: 561.0px; height: 145.5px;" /></a>
</figure>
<ul class="simple">
<li><p>The excitation operator exponential <span class="math notranslate nohighlight">\(e^{\theta G}\)</span> is expanded in a polynomial form,
rather than decomposed into quantum gates.
See <a class="reference internal" href="advanced.html#engines"><span class="std std-ref">Engines</span></a> for more details.</p></li>
<li><p>Excitations are implemented as efficient bitstring manipulations.</p></li>
<li><p>TenCirChem also has an efficient algorithm to calculate UCC gradient, described in <a class="reference internal" href="#how-does-tencirchem-evaluate-ucc-gradient">How does TenCirChem evaluate UCC gradient?</a>.</p></li>
</ul>
</section>
<section id="how-does-tencirchem-evaluate-ucc-gradient">
<h2>How does TenCirChem evaluate UCC gradient?<a class="headerlink" href="#how-does-tencirchem-evaluate-ucc-gradient" title="Permalink to this heading">#</a></h2>
<p>In general there are two ways in TenCirChem to evaluate energy gradient with respect to parameters in UCC.
The first is by JAX auto-differentiation. The related concepts can be found in
<a class="reference external" href="https://jax.readthedocs.io/en/latest/jax-101/index.html">JAX documentation</a>.</p>
<p>The second method is hard-coded gradient, which is generally more efficient.</p>
<p>Suppose the ansatz has the form</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[| \psi \rangle = \prod_{k=M}^{1} e^{\theta_k G_k} | \rm{HF} \rangle\]</div>
</div>
<p>and <span class="math notranslate nohighlight">\(|\psi \rangle\)</span> is real. Define</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\langle \phi^{(1)}_j | &amp; = \langle \psi | \hat H \prod_{k=M}^{j} e^{\theta_k G_k} \\
| \phi^{(2)}_j \rangle &amp; = \prod_{k=j}^1 e^{\theta_k G_k}  | \rm{HF} \rangle
\end{align}\end{split}\]</div>
</div>
<p>The energy expectation can be written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\langle E \rangle = \langle \phi^{(1)}_{j+1} | \phi^{(2)}_j \rangle\]</div>
</div>
<p>then the energy gradient is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\frac{\partial \langle E \rangle}{\partial \theta_j} =
2\langle \phi^{(1)}_{j+1} |  G_j | \phi^{(2)}_j \rangle\]</div>
</div>
<p>In practical implementation, <span class="math notranslate nohighlight">\(\langle \phi^{(1)}_{M+1} |=\langle \psi | \hat H\)</span>
and <span class="math notranslate nohighlight">\(| \phi^{(2)}_{M} \rangle = |\psi \rangle\)</span>
are firstly calculated after <span class="math notranslate nohighlight">\(| \psi \rangle\)</span> is obtained.
Then, <span class="math notranslate nohighlight">\(\langle \phi^{(1)}_j |\)</span> and <span class="math notranslate nohighlight">\(| \phi^{(2)}_{j-1} \rangle\)</span> are obtained by the recursion relation</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\langle \phi^{(1)}_j | &amp; = \langle \phi^{(1)}_{j+1} | e^{\theta_j G_j} \\
| \phi^{(2)}_{j-1} \rangle &amp; = e^{-\theta_{j} G_{j}}  | \phi^{(2)}_{j} \rangle
\end{align}\end{split}\]</div>
</div>
<p>For each pair of <span class="math notranslate nohighlight">\(\langle \phi^{(1)}_{j} |\)</span> and <span class="math notranslate nohighlight">\(| \phi^{(2)}_{j-1} \rangle\)</span>,
<span class="math notranslate nohighlight">\(\frac{\partial \langle E \rangle}{\partial \theta_j}\)</span> is calculated.
Thus, this algorithm computes all gradients in one sweeping pass, requiring a constant amount of memory.</p>
</section>
<section id="how-to-use-gpu-in-tencirchem">
<h2>How to use GPU in TenCirChem?<a class="headerlink" href="#how-to-use-gpu-in-tencirchem" title="Permalink to this heading">#</a></h2>
<p>Choosing device is done by choosing backend for TenCirChem.
TenCirChem by default uses NumPy backend, and supports JAX and CuPy backend.
Both JAX and CuPy supports GPU.
Install JAX and CuPy with appropriate GPU driver and set the backend in the following way</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tencirchem</span> <span class="kn">import</span> <span class="n">set_backend</span>
<span class="n">set_backend</span><span class="p">(</span><span class="s2">&quot;cupy&quot;</span><span class="p">)</span>  <span class="c1"># or &quot;jax&quot;</span>
</pre></div>
</div>
<p>More fine-grained control over the devices is achieved through the JAX or CuPy package</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="c1"># use the second GPU</span>
<span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">use</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="why-is-jax-backend-so-slow-on-first-run">
<h2>Why is JAX backend so slow on first run?<a class="headerlink" href="#why-is-jax-backend-so-slow-on-first-run" title="Permalink to this heading">#</a></h2>
<p>JAX features JIT compilation, and the compile time can be quite long for typical TenCirChem use cases.
In TenCirChem, it is common that the JIT compilation time is much longer than the actual optimization time.
TenCirChem has already optimized the compilation speed,
yet there are simply too many instructions in typical UCC circuit.
The <a class="reference external" href="https://jax.readthedocs.io/en/latest/faq.html#jit-decorated-function-is-very-slow-to-compile">JAX document</a>
offers more information on slow compilation.</p>
<p>If you’re using CPU based JAX, switching to the GPU version can significantly speed up compilation.
Otherwise, to the author’s knowledge currently there’s no way to solve the slow compilation problem.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="modules.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="tutorial_jupyter/marcus.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Observing Marcus Inverted Region</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, The TenCirChem Authors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#what-are-the-conventions-for-excitation-operators-integrals-orbital-indices">What are the conventions for excitation operators/integrals/orbital indices…</a></li>
<li><a class="reference internal" href="#why-are-the-number-of-excitation-operators-and-the-number-of-parameters-different-what-is-param-ids">Why are the number of excitation operators and the number of parameters different?/What is <code class="docutils literal notranslate"><span class="pre">param_ids</span></code>?</a></li>
<li><a class="reference internal" href="#why-is-tencirchem-so-fast">Why is TenCirChem so fast?</a></li>
<li><a class="reference internal" href="#how-does-tencirchem-evaluate-ucc-gradient">How does TenCirChem evaluate UCC gradient?</a></li>
<li><a class="reference internal" href="#how-to-use-gpu-in-tencirchem">How to use GPU in TenCirChem?</a></li>
<li><a class="reference internal" href="#why-is-jax-backend-so-slow-on-first-run">Why is JAX backend so slow on first run?</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>